\documentclass{standalone}
\usepackage[utf8]{inputenc}

\usepackage{graphicx}
\graphicspath{ {./images/} }

\usepackage{siunitx}

\usepackage{placeins}

\usepackage{csquotes}

\usepackage{enumitem}

%%% Tikz 
\usepackage{tikz}
\usepackage{pgfplots}\pgfplotsset{compat=1.18}
%\usepackage{pgfplotstable}
\usepackage{pgfmath}
\usetikzlibrary{arrows.meta,positioning,calc,intersections,shapes,angles,patterns,quotes}
\usepgfplotslibrary{units, groupplots, statistics}


\usepackage{amsmath} % for the equation* environment
\usepackage{amsfonts}
\usepackage{amssymb}

\usepackage{hyperref}



\begin{document}


    
\begin{tikzpicture}
    \tikzstyle{box}=[
        rectangle,
        draw=black, 
        align=center,
        text width=1.8cm,
        minimum width=1.8cm,
        minimum height=1.5cm, 
    ]
    \tikzstyle{neuron}=[
        circle,
        draw=black, 
        inner sep=0pt, 
        outer sep=0pt,
        minimum size=1.5cm,
    ]
    
    \node (theta) at (0, 0) {\Large$\theta$};
    \node (theta_d) at ([yshift=-3cm]theta) {\Large$\dot{\theta}$};

    \node[box] (sin) at ([xshift=3cm]theta) {\Large$\sin$};
    
    \node[box] (tanh) at ([xshift=4cm]sin) {};
    \begin{axis}[
            at=(tanh),
            anchor=center,
            width=3cm,
            height=2.6cm,
            hide axis,
            ymin=-1.1, ymax=1.1,
            xmin=-4, xmax=4,
        ]
        %\addplot[color=black] table [col sep=comma, x=time, y=1]{data/Intro/voltage_spiking.csv};
        \addplot[color=black,domain=-4:4,samples=100] {tanh(x)};
        \draw[gray,-stealth] (-3.9,0)--(3.9,0);
        \draw[gray,-stealth] (0,-1)--(0,1);
    \end{axis}
    
    \node[box] (bump) at ([yshift=-3cm]sin) {};
    \begin{axis}[
            at=(bump),
            anchor=center,
            width=3cm,
            height=2.7cm,
            hide axis,
            ymin=-0.1, ymax=2.6,
            xmin=-10.1, xmax=10.1,
        ]
        %\addplot[color=black] table [col sep=comma, x=time, y=1]{data/Intro/voltage_spiking.csv};
        \addplot[color=black,domain=-9:9,samples=100] {tanh(x+2.5)-tanh(x-2.5)};
        \draw[gray,-stealth] (-10,0)--(10,0);
        \draw[gray,-stealth] (0,0)--(0,2.5);
    \end{axis}
    
    \coordinate (mean) at ($(tanh)!0.5!(bump)$);
    
    \node[circle, draw=black, inner sep=0pt, outer sep=0pt, minimum size=0.8cm] (add) at ([yshift=-3cm]tanh) {};
    \node[scale=0.8,below] at (add.north) {$+$};
    \node[scale=0.8,right] at (add.west) {$+$};
    
    \node[neuron] (spike) at ([xshift=3cm]add) {};
    \begin{axis}[
            at=(spike),
            anchor=center,
            width=2.5cm,
            height=2.5cm,
            hide axis,
            ymin=-2.5, ymax=2.5,
            xmin=6.8, xmax=7.2,
        ]
        \addplot[color=black] table [col sep=comma, x=time, y=1]{data/Intro/voltage_spiking.csv};
    \end{axis}
    
    \node[box] (synap) at ([xshift=3cm]spike) {Synapse};
    
    \node (out) at ([xshift=3cm]synap) {\Large$I_\text{feedback}$};
    
    \draw[-stealth] (theta) -- (sin);
    \draw[-stealth] (sin) -- (tanh);
    \draw[-stealth] (tanh) -- (add);
    \draw[-stealth] (theta_d) -- (bump);
    \draw[-stealth] (bump)  -- (add);
    \draw[-stealth] (add) -- (spike);
    \draw[-stealth] (spike) -- (synap);
    \draw[-stealth] (synap) -- (out);
\end{tikzpicture} 

    
    
\iffalse
    \node[neuron] (mod_n) at ([xshift=3cm]out) {};
    \begin{axis}[
            at=(mod_n),
            anchor=center,
            width=2.5cm,
            height=2.5cm,
            hide axis,
            ymin=-2.5, ymax=2.5,
            xmin=6.8, xmax=7.2,
        ]
        \addplot[color=black] table [col sep=comma, x=time, y=1]{data/Intro/voltage_spiking.csv};
    \end{axis}
\fi

\end{document}
