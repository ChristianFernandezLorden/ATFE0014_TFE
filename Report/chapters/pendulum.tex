\label{sec:pendulum}

The previous chapter explored the different behaviors exhibited by the neuron model.
This chapter focuses on the control of a cylindrical pendulum with a neuromorphic controller built using artificial neurons.
The primary goal is to find and extract a control scheme that is intrinsically linked to the mechanical system.
To reach this goal, the different useful behaviors of the neuron model will be paired with multiple feedback models.
The models will be evaluated on the basis of their performance and robustness.

\section{The mechanical system}

Before diving into controller design, understanding the mechanical system is important.
\Cref{fig:pendulum} shows a graphical representation of the system.
This diagram shows that there is only a single control input to this system, the applied torque $\tau$.
The system also provides two meaningful state outputs, the angle $\theta$ with the vertical line and the angular velocity $\dot{\theta}$.
Finally, the dynamics of the pendulum are influenced by five parameters: radius $r$ of the cylinder, height $h$ of the cylinder, density $\rho$ of the cylinder, damping coefficient $B_f$, which generates the friction torque $\tau_f$ at the rotation point, and gravity $\mathbf{g}$. 
\begin{figure}[!htb]
    \centering
    \inserttikzfig{diagrams/pendulum_system.tikz}
    \caption{Diagram of the pendulum system. The parameters of the pendulum are shown in blue, the outputs that are fed to the controller are shown in red, and the actuation of the controller is shown in green.}
    \label{fig:pendulum}
\end{figure}

In the figure, the gray arrow shows and defines the down direction, which is the reference of the angle $\theta$.
It can be used to separate the rotation plane into two halves.
The half with negative $\sin\left(\theta\right)$ and the half with positive $\sin\left(\theta\right)$.

%Keeping the parameters in a certain close range is obviously necessary.
%A controller capable of stabilizing the oscillation of a \qty{1}{\milli\meter} pendulum will struggle and fail when applied on a \qty{1}{\meter} long pendulum. Keeping the values in same order of magnitude is necessary.
For simplicity, the parameters of the pendulum are kept constant. The values used for all simulations are as follows.
{

\large\centering
\begin{tabular}{lr|lr}
    $r$     & \qty{0.05}{\meter}                  & $B_f$    & \qty{0.01}{\newton\meter\second\per\degree} = \qty{0.57}{\newton\meter\second\per\radian}\\
    $h$     & \qty{0.5}{\meter}                   & $\mathbf{g}$    & \qty{9.81}{\meter\per\second\squared}\\
    $\rho$  & \qty{1000}{\kg\per\cubic\meter}     &               & \\
\end{tabular}

}

The value of friction $\tau_f$ can be computed from the following equation.
\begin{align}
    \tau_f = \dot{\theta}B_f
\end{align}
It is thus dependent on the angular velocity of the pendulum $\dot{\theta}$.

\section{Sensory feedback types}

The feedback sent to the bursting neuron is at the heart of the stability of the neuronal system.
Bad feedback can only lead to bad performances.
Thus, three different feedback mechanisms are proposed.
This ranges from the most simplistic feedback that relies only on the angle of the pendulum to complex spiking neuron-based feedback.
The goal of proposing multiple feedback is to find a middle ground between feedback complexity and performance.

\subsection{Angle based feedback}

The first feedback described in \cref{fig:direct_angle} is the most simplistic.
The direct angle feedback sends to the bursting neuron the sinus of the angle. 
When in the lower half of the rotational range, this value becomes increasingly negative as the pendulum angle $\theta$ decreases and vice versa when increasing.

\begin{figure}[!htb]
    \centering
    \inserttikzfig{diagrams/direct_angle_feed.tikz}
    \caption{Diagram of the direct angle feedback.}
    \label{fig:direct_angle}
\end{figure}

\begin{align}
    I_\text{feed} = K_\text{feed}\alpha_\text{dir}\sin\left(\theta\right)
\end{align}
with $\alpha_\text{dir} \in \left\{-1,\,1\right\}$ and $K_\text{feed} > 0$.

$\alpha_\text{dir}$ is a parameter relative to the part of the half plane where the feedback should be active, $1$ signifies an activation in the half where $\sin\left(\theta\right)>0$ and $-1$ the other half. 
$K_\text{feed}$ is the output gain of the feedback.

\subsection{Angle and angular velocity based feedback}\label{sec:speed_feed}

This more complicated feedback described in \cref{fig:speed_angle} aims to send a positive value to the controller only when it is close to the optimal control timing, i.e., when the angular velocity $\dot{\theta}$ is close to $0$.
In addition, the feedback should only send a pulse when the pendulum is in the correct half of the rotation plane.

\begin{figure}[!htb]
    \centering
    \inserttikzfig{diagrams/speed_angle_feed.tikz}
    \caption{Diagram of the mixed angle and speed feedback.}
    \label{fig:speed_angle}
\end{figure}

\begin{align}
    I_\theta &= \frac{\alpha_\text{dir}\tanh\left(g_\theta\left(\sin\left(\theta\right)-d_\text{off}\right)\right) + 1}{2} - 1\label{eq:speed_theta}\\
    I_{\dot{\theta}} &= \frac{\tanh\left(g_{\dot{\theta}}\left(\dot{\theta}+d_\text{bump}\right)\right) -\tanh\left(g_{\dot{\theta}}\left(\dot{\theta}-d_\text{bump}\right)\right)}{2}\label{eq:speed_bump}\\
    I_\text{feed} &= K_\text{feed}\text{min}\left(\text{max}\left(0,\, I_\theta + I_{\dot{\theta}}\right),\, 1\right)
\end{align}
with $\alpha_\text{dir} \in \left\{-1,\,1\right\}$, $g_\theta, g_{\dot{\theta}}, d_\text{bump}, K_\text{feed} > 0$ and $d_\text{off} \in \mathbb{r}$.

$\alpha_\text{dir}$ is a parameter relative to the part of the half plane where the feedback should be active, $1$ signifies an activation in the half where $\sin\left(\theta\right)>0$ and $-1$ the other half.
$g_\theta$ and $g_{\dot{\theta}}$ are parameter that define the sharpness of the transition of their respective $\tanh$.
$d_\text{off}$ is a term that offsets $I_\theta$ to create an activation when $\theta = 0$. Since $\theta = 0$ is the resting state of the system, adding the offset avoids the system being blocked in that position.
$d_\text{bump}$ defines the width of the bump around $\dot{\theta} = 0$.
$K_\text{feed}$ is the output gain of the feedback.

For all simulations, the feedback will use the following parameter values.
{

\large\centering
\begin{tabular}{lr|lr}
    $g_\theta$      & \qty{15}{\ampere\per\radian}   & $g_{\dot{\theta}}$    & \qty{5}{\ampere\second\per\radian}\\
    $d_\text{off}$ & \qty{0.05}{\radian}  & $d_\text{bump}$       & \qty{0.5}{\radian\per\second}
\end{tabular}

}

\subsection{Spike based feedback}

The last feedback defined in \cref{fig:spike_feed} reuses principles from the previous feedback but seeks complete neuronal control using a spiking neuron coupled with a synapse to activate the controller.
This approach has the advantage that the width of the pulse sent to the controller remains nearly constant and not largely influenced by the maximum rotational speed.
It also guarantees the event-based nature of the feedback.

\begin{figure}[!htb]
    \centering
    \inserttikzfig{diagrams/spike_feed.tikz}
    \caption{Diagram of the spike feedback.}
    \label{fig:spike_feed}
\end{figure}

\begin{align}
    I_\theta &= \frac{\alpha_\text{dir}\tanh\left(g_\theta\left(\sin\left(\theta\right)-d_\text{off}\right)\right) + 1}{2} - 1\\
    I_{\dot{\theta}} &= \frac{\tanh\left(g_{\dot{\theta}}\left(\dot{\theta}+d_\text{bump}\right)\right) -\tanh\left(g_{\dot{\theta}}\left(\dot{\theta}-d_\text{bump}\right)\right)}{2}-1\\
    V_\text{neur} &= \text{spiking\_neuron}\left(I_\theta + I_{\dot{\theta}}\right)\\
    I_\text{feed} &= \text{synapse}\left(V_\text{neur}\right)
\end{align}
with $\alpha_\text{dir} \in \left\{-1,\,1\right\}$, $g_\theta, g_{\dot{\theta}}, d_\text{bump}, K_\text{feed} > 0$, $d_\text{off} \in \mathbb{r}$, spiking\_neuron is an instance of the neuron defined in \cref{fig:neuron_mod} and synapse is an instance of the synapse defined in \cref{fig:synapse_mod}.

$\alpha_\text{dir}$ is a parameter relative to the part of the half plane where the feedback should be active, $1$ signifies an activation in the half where $\sin\left(\theta\right)>0$ and $-1$ the other half. 
$g_\theta$ and $g_{\dot{\theta}}$ are parameter that define the sharpness of the transition of their respective $\tanh$.
$d_\text{off}$ is a term that offsets $I_\theta$ to create an activation when $\theta = 0$. Since $\theta = 0$ is the resting state of the system, adding the offset avoids the system being blocked in that position.
$d_\text{bump}$ defines the width of the bump around $\dot{\theta} = 0$.
The parameter $g_{\text{syn}}$ will be used as the output gain of the feedback instead of a $K_\text{feed}$ parameter. 

For all simulations, the feedback will use the following parameter values.
{

\large\centering
\begin{tabular}{lr|lr|lr}
    $g_\theta$      & \qty{15}{\ampere\per\radian}  & $g_{\dot{\theta}}$    & \qty{5}{\ampere\second\per\radian} & $d_\text{off}$  &    \qty{0.05}{\radian}\\
    $d_\text{bump}$       & \qty{0.5}{\radian\per\second} & $g_{f-}$    & \qty{-2}{\siemens}   & $g_{u+}$          & \qty{1}{\siemens}\\
    $g_{s+}$    & \qty{4}{\siemens}    & $I_\text{app}$    & \qty{0.1}{\ampere} & $g_{s-}$    & \qty{-1}{\siemens}\\
    $d_\text{syn}$    & \qty{-0.5}{\volt} & & & &
\end{tabular}

}

While this controller should generate output similar to the simple mixed feedback, the advantage of using a neuron spike is the stability of the pulse width.
Indeed, the width of the mixed feedback is determined in part by the acceleration of the pendulum, which is linked to the angle at which the speed crosses $0$.
The spike of a neuron does not suffer from this problem.
In addition, a spiking neuron has a refractory period that prevents it from recreating a pulse too quickly.
However, because of the inertia of the pendulum, this problem should not be encountered by the mixed feedback most of the time. 

\section{Controller with single motor neuron}

The first use of the various feedback defined previously is to simply connect the feedback to a bursting neuron that will only be able to apply torque in a single direction.
\Cref{fig:one_motor} represents the proposed controller architecture.
The output of the bursting neuron is passed through a saturation function that limits the output of the neuron between 0 and 1.
This leads the neuron to generate torque only during bursting.
The gain at the saturation output defines the strength of the actuation.
This controller architecture is naturally imbalanced since the actuation is not symmetric and thus the damping inside the pendulum will always lead to a lower amplitude on the side of actuation. 

\begin{figure}[!htb]
    \centering
    \inserttikzfig{diagrams/one_motor.tikz}
    \caption{Diagram of the sensorimotor loop for the single-neuron controller. The saturation block limits are \qty{0}{\volt} to \qty{1}{\volt}. The saturation block also contains an internal output gain $\tau_\text{max}$.}
    \label{fig:one_motor}
\end{figure}

\Cref{fig:one_motor_demo} displays a realization of this controller. This clearly shows the imbalanced nature of the controller when the angle oscillates from \qtyrange{-0.5}{1}{\radian}. It is interesting to observe the regularity of the oscillation, which indicates that the controller is well attuned to the mechanical system.

\begin{figure}[!htb]
    \centering
    \inserttikzfig{plots/one_motor_demo.tikz}
    \caption{Simulation of a well parameterized single-neuron controller-pendulum system. Using mixed feedback with $\tau_\text{max}=\qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 1$.}
    \label{fig:one_motor_demo}
\end{figure}

\subsection{Performance of the sensorimotor loop}

The performance of a controller can be accessed by its ability to generate stable oscillations of large amplitude.
To study the oscillation resulting from the proposed controller, an analysis of the parameters of the bursting neuron $g_{s-}$, $g_{u+}$ and $I_\text{app}$ and the parameters of the strength of the feedback $K_\text{feed}$ or $g_\text{syn}$ on the oscillation was performed.
In addition, two different output gain $\tau_\text{max} = \qty{1}{\newton\meter\per\volt}$ and $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ were used to determine the appropriate force to effectively control the system. 

\Cref{fig:single_t1_low,fig:single_t1_high} show the responses with a low output gain on the torque while \cref{fig:single_t10_low,fig:single_t10_high} show a high output gain.
The first thing that is clear when looking at these figures is that $\tau_\text{max} = \qty{1}{\newton\meter\per\volt}$ is not high enough for this system to sustain large oscillation and, by extension, exercise good control over the oscillation.
Indeed, the maximum range of oscillation is lower than \qty{0.3}{\radian} while for $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ the oscillations reach nearly \qty{3.14}{\radian}.
Thus, maps using $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ are more useful because they display what will be used later.
However, the other maps can still be useful for identifying behaviors in specific situations.

%So, while the maps using $\tau_\text{max} = \qty{1}{\newton\meter\per\volt}$ are still used, most conclusion are drawn from the maps using $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$.

\Cref{fig:single_t1_low_freq,fig:single_t1_high_freq,fig:single_t10_low_freq,fig:single_t10_high_freq} shows that mixed and spiking feedback can generate oscillations with lower $I_\text{app}$ compared to the sinusoidal feedback.
Now looking at \Cref{fig:single_t10_low_range,fig:single_t10_high_range} shows that the mixed and spiking feedback can reach the oscillations with the greatest amplitudes.

Now looking at $I_\text{app} = \qty{-1}{\ampere}$ and especially $I_\text{app} = \qty{0}{\ampere}$, the maps of the controller with feedback become closer to the map of the controller without feedback.
This indicates that those higher $I_\text{app}$ are not as relevant because they lead to behavior close to no feedback, which can only lead to poor control.
The range of oscillation maps confirms this because they show that higher $I_\text{app}$ lead to far lower oscillation amplitudes.
This shows the poorness of the control because efficient control should be able to generate high-amplitude oscillations.

In \cref{fig:single_t10_high_range} the  map of the mixed or spiking feedback when $I_\text{app}=\qty{-2}{\ampere}$ seems to validate \cref{fig:neuron_burst_spikes,fig:neuron_burst_power} as lowering $g_{s-}$ is well correlated with the amplitude of the oscillations. 
This shows the link between the value of $g_{s-}$ and the power contained in a burst.

Now, comparing the different feedback, it seems that the sinusoidal feedback has a behavior different from the mixed and spiked feedback. 
Meanwhile, the mixed and spiked feedbacks have very similar behaviors.
This can be explained by the mixed feedback having a spike-like behavior near $\dot{\theta}=0$ and the spike feedback neuron is excited when near to $\dot{\theta}=0$.
Thus, both types of feedback generate a spike when the angular velocity is low.
However, note that in \cref{fig:single_t1_high} the spiking feedback generates relatively more oscillation than the mixed feedback model.

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.46\textheight][b]{\textwidth}
        \centering
        \caption{Maps of the frequency of the pendulum oscillation.}
        \inserttikzfig{plots/single_freq_t1.tikz}
        \label{fig:single_t1_low_freq}
    \end{subfigure}
    
    \begin{subfigure}[b][.46\textheight][t]{\textwidth}
        \centering
        \caption{Maps of the range of the pendulum oscillation.}
        \inserttikzfig{plots/single_range_t1.tikz}
        \label{fig:single_t1_low_range}
    \end{subfigure}
    \caption{Single-neuron controller-pendulum system behavior with $\tau_\text{max} = \qty{1}{\newton\meter\per\volt}$ and $K_\text{feed} = 1$ or $g_{\text{syn}} = \qty{1}{\siemens}$.}
    \label{fig:single_t1_low}
\end{figure}

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.46\textheight][b]{\textwidth}
        \centering
        \caption{Maps of the frequency of the pendulum oscillation.}
        \inserttikzfig{plots/single_freq_t1_high.tikz}
        \label{fig:single_t1_high_freq}  
    \end{subfigure}
    
    \begin{subfigure}[b][.46\textheight][t]{\textwidth}
        \centering
        \caption{Maps of the range of the pendulum oscillation.}
        \inserttikzfig{plots/single_range_t1_high.tikz}
        \label{fig:single_t1_high_range}  
    \end{subfigure}
    \caption{Single-neuron controller-pendulum system behavior with $\tau_\text{max}=\qty{1}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$.}
    \label{fig:single_t1_high}
\end{figure}

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.46\textheight][b]{\textwidth}
        \centering
        \caption{Maps of the frequency of the pendulum oscillation.}
        \inserttikzfig{plots/single_freq_t10.tikz}
        \label{fig:single_t10_low_freq}
    \end{subfigure}
    
    \begin{subfigure}[b][.46\textheight][t]{\textwidth}
        \centering
        \caption{Maps of the range of the pendulum oscillation.}
        \inserttikzfig{plots/single_range_t10.tikz}
        \label{fig:single_t10_low_range}
    \end{subfigure}
    \caption{Single-neuron controller-pendulum system behavior with $\tau_\text{max}=\qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 1$ or $g_{\text{syn}} = \qty{1}{\siemens}$.}
    \label{fig:single_t10_low}
\end{figure}

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.46\textheight][b]{\textwidth}
        \centering
        \caption{Maps of the frequency of the pendulum oscillation.}
        \inserttikzfig{plots/single_freq_t10_high.tikz}
        \label{fig:single_t10_high_freq}
    \end{subfigure}
    
    \begin{subfigure}[b][.46\textheight][t]{\textwidth}
        \centering
        \caption{Maps of the range of the pendulum oscillation.}
        \inserttikzfig{plots/single_range_t10_high.tikz}
        \label{fig:single_t10_high_range}
    \end{subfigure}
    \caption{Single-neuron controller-pendulum system behavior with $\tau_\text{max}=\qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$.}
    \label{fig:single_t10_high}
\end{figure}
% Compare with bursting frequency

The analysis of the maps seems to point toward low $I_\text{app}$, high $\tau_\text{max}$, high strength of feedback, and mixed or spiking feedback as the best controller.

However, the analysis highlighted some zones of interest.
\Cref{fig:single_control_traces} shows the oscillation generated in three zones of interest.

The first four rows of traces show the behavior of all feedback types at the specific point seen in \cref{fig:single_t10_high} where the uncoupled bursting neuron can generate large oscillations.
The idea is to investigate why a system receiving no information about the state of the pendulum can generate "good" oscillation and what adding feedback can do in the same situation.
Looking at the traces of the angle $\theta$ for the case without feedback, it appears that the frequency of bursting coincides with the frequency of the pendulum.
The match is not perfect because the amplitude of oscillation varies slightly but it still remains within a small range.
Considering the effect of the feedback when using the same parameter for bursting and choosing the highest sensory feedback strength, the oscillation pattern does not change.
Some phase is introduced between feedback types because the bursting patterns are not in sync, but the shape of a burst and the inter-burst frequency are nearly the same in all cases.
This highlights a critical behavior, if the neuron has a high base excitatory current, which is the case here since \cref{fig:neuron_activation} indicates that bursting with these parameters starts slightly above $I_\text{app} = \qty{-2}{\ampere}$, then the feedback becomes less effective and thus the connection between the neuron and the mechanical system is diminished.
This is the opposite of the desired behavior.

Next, the fifth and sixth rows in \cref{fig:single_control_traces} show a more desirable behavior. 

Here, the mixed and neuron feedback are shown with a better set of parameters as seen in \cref{fig:single_t10_high}.
Here, the lower base current allows the feedback to dominate the activation of the neuron.
This results in a strong connection between the neuron and the mechanical system.
The oscillation traces confirm this because they have a greater amplitude than the parameter discussed before and are extremely regular.
The regularity of these oscillations completely demonstrates the link between the neuron and the pendulum because a perfect match between the inter-burst frequency and the oscillation frequency is only possible if the bursting is modulated by feedback.

Finally, for most of the analysis, the mixed and neuronal feedbacks were grouped together and showed identical performances.
However, they are not the same, and in specific cases, they display different behaviors.
The seventh and eighth rows in \cref{fig:single_control_traces} display this difference.
The parameters were taken from \cref{fig:single_t1_low} where the low current behavior seemed quite different.
Indeed, the traces confirm that they are.
The mixed feedback seems to be stuck in a behavior similar to that of the first row but with far smaller oscillation due to the lower gain on the torque.
This appears clearly with the variation in the amplitude of each oscillation and the seemingly constant bursting of the neuron.
Conversely, neuron feedback can generate far larger and more regular oscillations despite being subjected to the same parameters.
This difference can be explained easily when considering the equations that forms the feedback.
This boils down to the fact that mixed feedback is continuous, whereas neuron feedback is event-based.
This may seem a  bit strange because the mixed feedback, when declared in \cref{sec:speed_feed} was described as generating pulses.
However, looking back at the equations governing the feedback reveals that it only holds true if the angular velocity is high and then \cref{eq:speed_bump} is zero, except at the peak of the oscillation where the speed is close to zero.
In the case where the torque is low, the system may become stuck in a pattern of tiny oscillations that, due to the limited torque and range, do not have the velocity to get out of the bump.
Thus, mixed feedback can be abstracted as \cref{eq:speed_theta} plus one, which is feedback based only on position.\label{par:mixed_problem}
In the neuronal case, the behavior is different.
Even if the input to the spiking neuron is similar to the mixed feedback, passing this input into a spiking neuron transforms this continuous feedback into events.
If the neuronal feedback is placed in the same position as the mixed feedback, it spikes at a relatively low frequency, leading to a more stable activation, allowing it to exit the position and generate larger oscillations.

\begin{figure}[!htbp]
    \centering
    \inserttikzfig{plots/single_traces.tikz}
    \caption{Temporal behavior of a single-neuron controller-pendulum system under different parameters and with different feedback.}
    \label{fig:single_control_traces}
\end{figure}

\subsection{Robustness of the sensorimotor loop}

In a real controller, it is nearly impossible to achieve the exact theoretical parameters.
Therefore, it is important to analyze the behavior of the controller when the parameters deviate from the ideal values.
In the previous section, good parameters were found to be around $I_\text{app} = \qty{-2}{\ampere}$, $g_{s-} = \qty{-4}{\siemens}$ and $g_{u+} = \qty{5}{\siemens}$. 

The classical way of performing such an analysis is simply to use Monte Carlo by sampling the parameters from a certain distribution centered around the ideal values and plotting the distributions of the relevant output value to visualize the influence of these changing parameters on the control.
Before doing this, the robustness can already be assessed in \cref{fig:single_t1_low,fig:single_t1_high,fig:single_t10_low,fig:single_t10_high} by looking at the change in values around the chosen parameters.
Since $\tau_\text{max}=\qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$ gave the best controller results, those parameters will be used and thus only \cref{fig:single_t10_high} is relevant.
The maps of frequency and oscillation in that figure show that there is relative stability around the good parameters, at least in the $g_{s-}$ and $g_{u+}$ dimensions.
Here, relative stability means that the gradients of the frequency and amplitude maps are relatively low in amplitude and that there are no large discontinuities.

To have a point of comparison and further prove the point of the previous chapter, the fragile bursting displayed in \cref{fig:neuron_burts_fragile,fig:neuron_burts_comp} is chosen to compare the good parameters with a set of poor parameters.
To represent this behavior the fragile bursting has the parameters $I_\text{app} = \qty{0}{\ampere}$, $g_{s-} = \qty{-0.1}{\siemens}$ and $g_{u+} = \qty{4}{\siemens}$. $I_\text{app} = \qty{0}{\ampere}$ was chosen to place the fragile neuron in a similar situation to the robust neuron, i.e., before natural bursting.

With all that, \cref{fig:single_monte} displays the histograms resulting from the Monte Carlo simulations on the robust and fragile neuron coupled with all feedback previously defined. 

The first observation that can be made by looking at the distribution of in \cref{fig:single_monte_freq} is that the robust neuron is very precise and can maintain oscillation at the same frequency, except for the mixed feedback, which displays two very close frequencies.
On the other hand, the fragile neuron is much worse because the dominant frequency is spread over a large range of frequencies.
Especially in cases with no feedback and sinusoidal feedback.
However, the mixed feedback is again different from the others, with a behavior very similar to that of the robust neuron, except at a slightly higher frequency.

Looking at the amplitude of oscillation in \cref{fig:single_monte_range} gives a clearer picture of what is happening.
The amplitudes of oscillations of the robust neuron are far larger than those of the fragile neuron.
In fact, apart from the mixed feedback, the range of oscillation of the fragile neuron is nearly zero, proving that it is ineffective at generating oscillation.
It is also interesting to note that the range of the robust neuron with no feedback is perfectly zero, which is normal because the bursting neuron is inactivated.
However, this is not the case for the fragile neuron, which again shows that, as presented in \cref{fig:neuron_burts_comp}, the fragile neuron is very sensible to noise.

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.43\textheight][b]{\textwidth}
        \centering
        \caption{Histograms of the distribution of the dominant oscillation frequency.}
        \inserttikzfig{plots/control_monte.tikz}
        \label{fig:single_monte_freq}
    \end{subfigure}
    
    \begin{subfigure}[b][.43\textheight][t]{\textwidth}
        \centering
        \caption{Histogram of the distribution of the oscillation amplitude.}
        \inserttikzfig{plots/control_monte_range.tikz}
        \label{fig:single_monte_range}
    \end{subfigure}
    \caption{Comparison of the robustness of all feedback on the single-neuron controller-pendulum system using Monte Carlo analysis. The parameters of robust bursting were sampled from $I_\text{app} \sim \mathcal{N}\left(-2,\, 0.05^2\right) \unit{\ampere}$, $g_{s-} \sim \mathcal{N}\left(-4,\, 0.03^2\right) \unit{\siemens}$ and $g_{u+} \sim \mathcal{N}\left(5,\, 0.05^2\right) \unit{\siemens}$. The parameters of fragile bursting were sampled from $I_\text{app} \sim \mathcal{N}\left(0,\, 0.05^2\right) \unit{\ampere}$, $g_{s-} \sim \mathcal{N}\left(-0.1,\, 0.03^2\right) \unit{\siemens}$ and $g_{u+} \sim \mathcal{N}\left(4,\, 0.05^2\right) \unit{\siemens}$. Both neurons used $g_{f-} = \qty{-2}{\siemens}$, $g_{s+} = \qty{6}{\siemens}$, $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$.}
    \label{fig:single_monte}
\end{figure}

\Cref{fig:single_monte_robust} is a zoom in on the behavior of the robust neuron.
This figure highlights what was previously observed. The principal oscillation frequencies are shown to be very stable.
Sinusoidal and spiking neuron feedbacks lead to a single frequency, whereas mixed feedback leads to two separate frequencies, with no distribution in the frequency range.
Now looking at the range of oscillation, while all feedback span a similar range of around \qty{0.1}{\radian} the sinusoidal feedback seems to spread more than the other two feedback.
The other feedbacks have a large narrow peak and then a small wider peak with a range without oscillation between.
This shows a more precise control of the mixed and spiking feedback.
Yet, this second smaller is strange given the single frequency found.
This behavior could have been explained in the case of mixed feedback because it exhibits two separate frequencies; however, the number of simulations in the second peak of higher amplitude is higher than the number of simulations in the smallest frequency; therefore, this cannot explain the entire peak.
This behavior arises from the fact that the dominant frequency is the frequency with the highest power; thus, it can be quite stable even if the oscillation changes slightly.

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t]{\textwidth}
        \centering
        \caption{Histograms of the distribution of the dominant oscillation frequency.}
        \inserttikzfig{plots/control_monte_robust.tikz}
        \label{fig:single_monte_freq_robust}
    \end{subfigure}
    
    \begin{subfigure}[b]{\textwidth}
        \centering
        \caption{Histogram of the distribution of the oscillation amplitude.}
        \inserttikzfig{plots/control_monte_range_robust.tikz}
        \label{fig:single_monte_range_robust}
    \end{subfigure}
    \caption{Comparison of the robustness of all feedback on the single-neuron controller–pendulum system using Monte Carlo analysis. The bursting parameters were sampled from $I_\text{app} \sim \mathcal{N}\left(-2,\, 0.05^2\right) \unit{\ampere}$, $g_{s-} \sim \mathcal{N}\left(-4,\, 0.03^2\right) \unit{\siemens}$ and $g_{u+} \sim \mathcal{N}\left(5,\, 0.05^2\right) \unit{\siemens}$. The bursting also used $g_{f-} = \qty{-2}{\siemens}$, $g_{s+} = \qty{6}{\siemens}$, $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$.}
    \label{fig:single_monte_robust}
\end{figure}

\FloatBarrier
\section{Two neuron "push-pull" controller}\label{sec:two_neuron}

The next step in the controller design is to make it symmetrical by adding a new bursting neuron and its associated feedback block.
In addition, to enforce the alternating activation of bursting neurons, inhibitory synapses connect both neurons.
This turns the two neurons into a half-center oscillator.
This is done to avoid simultaneous activation of the neurons because it would be suboptimal to push in both rotational directions at the same time.

The feedback to the new bursting neuron will be tailored to mirror the feedback to the first neuron so that the new neuron activates during the other half of the rotation plane.

\begin{figure}[!htb]
    \centering
    \inserttikzfig{diagrams/two_motor.tikz}
    \caption{Diagram of the sensorimotor loop for the two-neuron push-pull controller. The saturation block limits are \qty{0}{\volt} to \qty{1}{\volt}. The adding block also contains an internal output gain $\tau_\text{max}$. Inhibitory synapses link both bursting neurons.}
    \label{fig:two_motor}
\end{figure}

Synapses have the same conductance because the system should be symmetrical. The common conductance is $g_\text{syn} = \qty{-1}{\siemens}$.

\Cref{fig:two_motor_demo} displays a realization of this controller. This shows that the addition of a neuron balances the oscillations. In addition, the neurons burst in perfect opposition, demonstrating HCO behavior. The large and regular oscillations indicate that the controller is well attuned to the mechanical system.

\begin{figure}[!htb]
    \centering
    \inserttikzfig{plots/two_motor_demo.tikz}
    \caption{Simulation of a well-parameterized two-neurons push-pull controller–pendulum system. Using mixed feedback with $\tau_\text{max}=\qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 1$.}
    \label{fig:two_motor_demo}
\end{figure}

\subsection{Performance of the sensorimotor loop}

Similar to the tests for the single-neuron controller, the performance of this new controller can be accessed by its ability to generate a stable oscillation of large amplitude.
Similarly, to study the proposed controller, the parameters of the bursting neuron $g_{s-}$, $g_{u+}$ and $I_\text{app}$ and the parameters of the strength of the feedback $K_\text{feed}$ or $g_\text{syn}$ are varied.
In addition, two different output gain $\tau_\text{max} = 1$ and $\tau_\text{max} = 10$ are studied to determine the appropriate force to effectively control the system.  % Vary strength of synapse

\Cref{fig:double_t1_low,fig:double_t1_high,fig:double_t10_low,fig:double_t10_high} display the behavior of the double neuron system in the same manner as \cref{fig:single_t1_low,fig:single_t1_high,fig:single_t10_low,fig:single_t10_high} that were used for the single neuron controller.

The first thing that is flagrant in this situation is that sinusoidal feedback always leads to a far lower amplitude of oscillation compared with mixed or spiking neuron feedback.
Except for $\tau_\text{max}=1$ and $K_\text{feed} = 5$ where \cref{fig:double_t1_high} shows that the mixed feedback seems to fail.
These lower oscillations are  mostly due to the feedback being directly linked to the angle, leading to an activation that is too early and is not able to reach large amplitudes.
Indeed in \cref{fig:double_t1_low,fig:double_t1_high} while the lower amplitude is still visible, the amplitude displayed is far better because the lower maximum torque restricts the possible oscillation range.

Now, analyzing the amplitude part of the results clearly shows that the gain of adding another control neuron allows far greater amplitude to be reached. 
\Cref{fig:single_t10_high} showed a maximum amplitude around $\pi$ while \cref{fig:double_t1_high} reaches $2\pi$ which is a full circle, which is impressive.

Interestingly, the CPG connection allows the system without feedback to generate sizable oscillations.
This is linked to the natural oscillatory nature of the connection (see \cref{fig:cpg_time}).
The controller lacking sensory feedback, these oscillations are naturally not attuned to the frequency of the pendulum and should generate very chaotic movement.
Yet, this displays quite well the usefulness of the CPG, it intrinsically captures the necessary order of the actuation of this system.

As observed in the single-neuron controller, it seems that in \cref{fig:double_t10_high} the maps of the range of oscillation validate the correlation between the value of $g_{s-}$ that was seen in \cref{fig:neuron_burst_spikes,fig:neuron_burst_power}.
However, it is less pronounced than in the case of a single-neuron controller, and the parameter $g_{u+}$ seems to now play a role.
\Cref{fig:cpg_act} shows that increasing $g_{u+}$ increase the natural bursting frequency of the CPG , and ideally, this frequency should be close to or lower than the natural oscillation frequency of the pendulum.
This poses a problem because oscillations of higher amplitude require a lower frequency.

Similar to the single-neuron controller, the analysis of the maps points toward a controller using mixed or spiking neuron feedback with low $I_\text{app}$, high $\tau_\text{max}$ and $K_\text{feed}$ or $g_\text{syn}$ as the best controller. 
It is the best in the sense that it can generate control of the oscillation in a reliable manner, and changing $g_{s-}$ and $g_{u+}$ allows to choose a desired amplitude of oscillation.

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.46\textheight][b]{\textwidth}
        \centering
        \caption{Maps of the frequency of the pendulum oscillation.}
        \inserttikzfig{plots/double_freq_t1.tikz}
        \label{fig:double_t1_low_freq}
    \end{subfigure}
    
    \begin{subfigure}[b][.46\textheight][t]{\textwidth}
        \centering
        \caption{Maps of the range of the pendulum oscillation.}
        \inserttikzfig{plots/double_range_t1.tikz}
        \label{fig:double_t1_low_range}
    \end{subfigure}
    \caption{Double-neuron controller–pendulum system behavior with $\tau_\text{max} = \qty{1}{\newton\meter\per\volt}$ and $K_\text{feed} = 1$ or $g_{\text{syn}} = \qty{1}{\siemens}$.}
    \label{fig:double_t1_low}
\end{figure}

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.46\textheight][b]{\textwidth}
        \centering
        \caption{Maps of the frequency of the pendulum oscillation.}
        \inserttikzfig{plots/double_freq_t1_high.tikz}
        \label{fig:double_t1_high_freq}  
    \end{subfigure}
    
    \begin{subfigure}[b][.46\textheight][t]{\textwidth}
        \centering
        \caption{Maps of the range of the pendulum oscillation.}
        \inserttikzfig{plots/double_range_t1_high.tikz}
        \label{fig:double_t1_high_range}  
    \end{subfigure}
    \caption{Double-neuron controller–pendulum system behavior with $\tau_\text{max} = \qty{1}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$.}
    \label{fig:double_t1_high}
\end{figure}

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.46\textheight][b]{\textwidth}
        \centering
        \caption{Maps of the frequency of the pendulum oscillation.}
        \inserttikzfig{plots/double_freq_t10.tikz}
        \label{fig:double_t10_low_freq}
    \end{subfigure}
    
    \begin{subfigure}[b][.46\textheight][t]{\textwidth}
        \centering
        \caption{Maps of the range of the pendulum oscillation.}
        \inserttikzfig{plots/double_range_t10.tikz}
        \label{fig:double_t10_low_range}
    \end{subfigure}
    \caption{Double-neuron controller–pendulum system behavior with $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 1$ or $g_{\text{syn}} = \qty{1}{\siemens}$.}
    \label{fig:double_t10_low}
\end{figure}

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[t][.46\textheight][b]{\textwidth}
        \centering
        \caption{Maps of the frequency of the pendulum oscillation.}
        \inserttikzfig{plots/double_freq_t10_high.tikz}
        \label{fig:double_t10_high_freq}
    \end{subfigure}
    
    \begin{subfigure}[b][.46\textheight][t]{\textwidth}
        \centering
        \caption{Maps of the range of the pendulum oscillation.}
        \inserttikzfig{plots/double_range_t10_high.tikz}
        \label{fig:double_t10_high_range}
    \end{subfigure}
    \caption{Double-neuron controller–pendulum system behavior with $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$.}
    \label{fig:double_t10_high}
\end{figure}

The analysis of the map has also led to the discovery of some interesting regions or phenomena.
\Cref{fig:double_control_traces} represent the temporal behavior of the controller in some of the most relevant regions.

The first of these regions is the region in \cref{fig:double_t10_high_range} at $I_\text{app} = \qty{0}{\ampere}$ where the controller without feedback is able to generate large oscillations and the controller using different feedbacks seems to exhibit a similar behavior, except for the controller using sinusoidal feedback.
This is a region similar to another that was studied for the single-neuron controller in \cref{fig:single_control_traces}. 

This region is explored in the first four rows.
The first row displays the behavior of the controller without feedback.
The neuron output clearly shows the CPG nature of the connection between the bursting neurons by the clear sequence of activation of the neurons.
In addition, this trace explains how this controller can generate large oscillations without feedback.
The bursting displays a plateau behavior that causes large oscillations because this behavior gives a large amount of momentum to the pendulum to move in one direction because the torque is applied constantly.
This gives a large oscillation, but the plot of the angle shows that it does not sync well with the frequency of the pendulum and leads to some variance in the amplitude of the oscillation.
The third and fourth rows show that the mixed and spiking neuron feedback have very similar behavior to the controller with no feedback.
This was already seen in the case of the single-neuron controller, where increasing $I_\text{app}$ reduces the feedback influence.
However, the second row displaying the controller with sinusoidal feedback challenges this conclusion.
This shows that with the same parameters the sinusoidal feedback generates smaller amplitudes and faster oscillations.
This is due to the continuous nature of the feedback, which constantly pushes the neuron to act when the amplitude is sufficiently large.
This implies two things.
First, this changes the previously made conclusion, it seems that high $I_\text{app}$ only reduce the effect of event-based feedback.
Then, this shows that sinusoidal feedback leads to a decision on a soft desired amplitude depending on the parameter $K_\text{feed}$ chosen.
Oscillations too large are not possible because they would excite the neuron so much that it would depolarize completely, and oscillation too low will not trigger the feedback and leads to either no oscillation if the CPG needs the feedback to burst or bad oscillation if it does not.

The fifth and sixth rows show the behavior of the mixed and spiking neuron controller with parameters taken from \cref{fig:double_t10_high} where both feedbacks showed good performance.
The spiking pattern and oscillation behaviors of both feedbacks are nearly identical, and there is only a slight temporal shift between them.
The oscillations generated by both are very regular and show no variance in their amplitude.
This again shows that event-based feedback coupled with low $I_\text{app}$ create a very efficient controller.

The seventh and eighth rows resolve the strange behavior of the mixed feedback controller seen in \cref{fig:double_t1_high} were the behavior of the mixed and spiking neuron controller differs despite being very similar in \cref{fig:double_t1_low,fig:double_t10_low,fig:double_t10_high}.
With the same parameter, the spiking neuron controller generates acceptable oscillations using bursting, even though they suffer from some variance in amplitude. However, the mixed controller generates far lower amplitude oscillation and is not bursting anymore, it just displays plateau potentials.
This behavior was already observed in the single-neuron controller and has the same cause.
To summarize the explanation seen in \cref{par:mixed_problem} on \cpageref{par:mixed_problem}, the mixed feedback defined in \cref{sec:speed_feed} loses its event-based nature when generating small oscillations and becomes continuous, thus losing performance.
In comparison, the spiking neuron feedback, despite using a similar function, circumvents this issue by feeding it to a spiking neuron, which guarantees the event-based nature of the sensory feedback to the bursting neuron.

\begin{figure}[!htbp]
    \centering
    \inserttikzfig{plots/double_traces.tikz}
    \caption{Temporal behavior of the double-neuron controller–pendulum system under different parameters and with different feedback. In the neuron output graphs, the blue and green traces represent the output of each neuron.}
    \label{fig:double_control_traces}
\end{figure}

\subsection{Robustness of the sensorimotor loop}

Again, it is impossible to create a physical controller with the same parameters as the theoretical controller.
Thus, evaluating the performance of the controller under small changes in the theoretical parameters allows the assessment of real-world performance.
Similar to the single-neuron controller, the ideal parameters of the controller are around $I_\text{app} = \qty{-2}{\ampere}$, $g_{s-} = \qty{-4}{\siemens}$ and $g_{u+} = \qty{5}{\siemens}$. 

The robustness of the controller can already be assessed partially by \cref{fig:double_t10_high} by observing that small variations of $g_{s-}$ and $g_{u+}$ around their ideal values only lead to small changes in the dominant frequency and amplitude.

To complete and confirm this analysis, the Monte Carlo method was applied to generate the distribution of the dominant frequency and the amplitude of oscillation when $I_\text{app}$, $g_{s-}$ and $g_{u+}$ are drawn from random distributions around the ideal values.

In addition, mirroring the analysis used for the single-neuron controller, another set of parameters for the bursting neuron was chosen for comparison with the bursting defined above.
To further prove the point made in the previous chapter, the fragile bursting displayed in \cref{fig:neuron_burts_fragile,fig:neuron_burts_comp} will be the point of comparison.
This neuron has the ideal parameters $I_\text{app} = \qty{0}{\ampere}$, $g_{s-} = \qty{-0.1}{\siemens}$ and $g_{u+} = \qty{4}{\siemens}$.

\Cref{fig:double_monte} displays the results of the Monte Carlo simulation analysis.
The first thing that is apparent, especially in \cref{fig:double_monte_range}, is that the fragile bursting is unable to control the pendulum.
The range of oscillation is always 0.
No feedback can make it control the system even slightly.
This is different from the behavior in the case of the single-neuron controller where \cref{fig:single_monte_range} showed that at least the mixed feedback was able to allow the fragile bursting to somewhat control the pendulum.
Note that in the case of the spiking neuron, some oscillations were generated since \cref{fig:double_monte_freq} shows a distribution of frequencies.
However, the range of oscillations all being grouped to zero shows that these oscillations are too poor to be useful.
This clearly demonstrates the fragile nature of this bursting, as the connection in a simple HCO pattern completely destroys the control capabilities of the neuron.

Now, looking at the distribution of the frequencies of the robust bursting in \cref{fig:double_monte_freq} it seems that for all feedback types, the dominant frequency of oscillation is very precise. However, the distribution of the amplitude of oscillation in \cref{fig:double_monte_range} shows that the sinusoidal feedback has nearly no variation in amplitude, whereas mixed and spiking neuron feedback do.
However, the oscillations of the  mixed and spiking neuron controllers are also far larger than those of the sinusoidal controller.
This shows that there is a certain trade-off between the size and variability of the oscillation amplitude.

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[b]{\textwidth}
        \centering
        \caption{Histograms of the distribution of the dominant oscillation frequency.}
        \inserttikzfig{plots/double_control_monte.tikz}
        \label{fig:double_monte_freq}
    \end{subfigure}
    
    \begin{subfigure}[b]{\textwidth}
        \centering
        \caption{Histogram of the distribution of the oscillation amplitude.}
        \inserttikzfig{plots/double_control_monte_range.tikz}
        \label{fig:double_monte_range}
    \end{subfigure}
    \caption{Comparison of the robustness of all feedback on the double-neuron controller–pendulum system using Monte Carlo analysis. The parameters of robust bursting were sampled from $I_\text{app} \sim \mathcal{N}\left(-2,\, 0.05^2\right) \unit{\ampere}$, $g_{s-} \sim \mathcal{N}\left(-4,\, 0.03^2\right) \unit{\siemens}$ and $g_{u+} \sim \mathcal{N}\left(5,\, 0.05^2\right) \unit{\siemens}$. The parameters of fragile bursting were sampled from $I_\text{app} \sim \mathcal{N}\left(0,\, 0.05^2\right) \unit{\ampere}$, $g_{s-} \sim \mathcal{N}\left(-0.1,\, 0.03^2\right) \unit{\siemens}$ and $g_{u+} \sim \mathcal{N}\left(4,\, 0.05^2\right) \unit{\siemens}$. Both neurons used $g_{f-} = \qty{-2}{\siemens}$, $g_{s+} = \qty{6}{\siemens}$, $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$.}
    \label{fig:double_monte}
\end{figure}

To investigate more closely the distributions of robust bursting, \cref{fig:double_monte_zoom} displays a  zoom on the different distributions.
This figure reveals multiple interesting behaviors that were not previously visible.

\Cref{fig:double_monte_freq_zoom} shows that the distribution of the dominant frequency of the spiking neuron controller has two peaks, whereas the other controllers only have one.
This was not visible in \cref{fig:double_monte} where they were both merged.
This is interesting because the single neuron controller \cref{fig:single_monte_robust} displayed the same distribution but for the mixed controller.
This reinforces the fact that these two types of feedback are quite similar and, in most cases, lead to similar performances.

Now looking at \cref{fig:double_monte_range_zoom} shows that the distributions of the oscillation amplitude are more in line with the behavior of the single neuron controller displayed in \cref{fig:single_monte_robust}.
Both figures show that the sinusoidal controller has a distribution centered around a single peak, whereas the mixed and spiking neuron controllers show a distribution with two peaks separated by a space with no simulation displaying that amplitude.

% fill some more

\begin{figure}[!htbp]
    \centering
    \begin{subfigure}[b]{\textwidth}
        \centering
        \caption{Histograms of the distribution of the dominant oscillation frequency.}
        \inserttikzfig{plots/double_control_monte_robust.tikz}
        \label{fig:double_monte_freq_zoom}
    \end{subfigure}
    
    \begin{subfigure}[b]{\textwidth}
        \centering
        \caption{Histogram of the distribution of the oscillation amplitude.}
        \inserttikzfig{plots/double_control_monte_range_robust.tikz}
        \label{fig:double_monte_range_zoom}
    \end{subfigure}
    \caption{Comparison of the robustness of all feedback on the double-neuron controller–pendulum system using Monte Carlo analysis. The bursting parameters were sampled from $I_\text{app} \sim \mathcal{N}\left(-2,\, 0.05^2\right) \unit{\ampere}$, $g_{s-} \sim \mathcal{N}\left(-4,\, 0.03^2\right) \unit{\siemens}$ and $g_{u+} \sim \mathcal{N}\left(5,\, 0.05^2\right) \unit{\siemens}$. The bursting also used $g_{f-} = \qty{-2}{\siemens}$, $g_{s+} = \qty{6}{\siemens}$, $\tau_\text{max} = \qty{10}{\newton\meter\per\volt}$ and $K_\text{feed} = 5$ or $g_{\text{syn}} = \qty{3}{\siemens}$.}
    \label{fig:double_monte_zoom}
\end{figure}

%\section{Discussion}


